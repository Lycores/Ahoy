## 小技巧

### 如何事件传参

柯里化，高级函数

### 如何避开CORS

setUpProxy

### 当父组件有事件需要获得子组件节点，但是子组件无法使用 ref 怎么办？

使用 forwardRef （这里可以继续展开）

### 传参方式

可以用state from location, useLocation hooks

## 遇到的问题

#### 我在做折叠卡片的时候，因为要watch很多卡片的状态，那么对应的事件函数也很多，我使用工厂模式放到一个函数里，用switch 分割，但还是太多，于是我想到使用新syntax，就是Variable[string]的方式，工厂模式的时候传入的string不再用在switch上，而是直接通过拼接成为object key 或者parameter. 这里遇到一个问题就是，我看到一些文章说，object key和它的string格式是等价的，其实不等价，他们打印出来一样但其实不一样，所以如果一个string想要当key,需要加[]成为[Computed property names](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Object_initializer#computed_property_names)

Play with Spotify API 的问题，因为是async请求，导致有些东西是空的，比如页面加载会自动请求，但是里面的attributes却是空的，因为attributes还没从服务器返回，比如说access_token

## 粗心的问题

大量比较粗心的问题暴露在api 调试上，打个比方，我先做了getsavedalbum这个功能，我发现它返回的json有完整的track信息，我一开始在请求让player播放的时候一直失败，后来我发现有一个叫position的信息是需要填的（但是API文档没有重点标识），这个postion指的是track在album中的index,所以想要给出track id让player播放是一件不可能的事情。后来我做了getTopTrack这个功能，但是getTopTrack这个功能返回的track没有他在album中的position这个信息，我想完了，我要请求十次album的信息才行。但是我如果连续async请求十次，服务器直接把我当ddos攻击了，后来我找到一个api，是一次请求获得多个album。不过后来我又发现，track里有一个叫track number的东西，它就是position，但是我怎么试服务器都给403，我最后发现的原因是，position是0开头，track number是1开头，我误以为track number也是0开头的，然后我测试的track正好是专辑的最后一张这导致我给服务器的position一直是out of range

player button onClick 直接叫了函数没有给函数指针，导致back, next, pause 在来回换，因为他们都被call了。音乐卡死了



## 设计模式

##### 首先在主页的卡片我们要追踪很多很多的卡片，那就有很多state需要更新，那就要放置很多的clickHandler, 那就有很多function。首先我们通过工厂模式集中更新state. 但是我发现使用简单的工厂模式依然有很长的switch, 后来我追加了一个工厂模式，通过 拼接注入的名字和某个字符串生成object的key，再使用es6 syntax computed property names, 使用一个function就替代了超长的代码



## 设计经验

（存疑）CSS layout设计应该以谁最重要，谁定义谁的尺寸就应该先被编写CSS。这是一种自下而上的设计。比如我想定义一个音乐播放器，而上方是一些playlist，他们竖直放在一个container里，我要求它在某个尺寸以下变为fixed的小播放器，这个时候player拥有更高的优先级。它应该先被定义。也就是说，player的尺寸先于container的尺寸被设计， 说到底，就是是先设计小部件的尺寸，再让宽高自己适应，还是先设计宽高，再设计小部件

设计的时候要避免watch 不必要的 state, 比如，onclick的时候，如果发生对象和作用对象一致，不需要用useRef， 直接event.target就可以。有时候为了方便调整layout我通常会设计很多global变量，做到修改一处代码整个layout修改。这个，与 responsive page是不同的，只有当尺寸改变需要相应才需要useState



## 路程

一开始只是想制作一个home assistance， 做完了card的transition之后我的野心变大了，想要做一个music player 带响应式的， 所以制作了top bar并且达到了响应式，然后开始制作playlist 页面在成功让spotify在我的页面运行之后我就觉得这个更像一个音乐播放器. 而且以前的home assistance感觉开始有点无聊 所以我在想怎么运用卡片这个废弃资产.在开发了album和artist页面后，我发现album page和artist page在左侧的重合率太高了，所以我一想这不就是navbar吗，所以我把左侧component独立出来然后用nested router 和outlet只刷新右侧，这让player的状态贯穿所有页面，player每次刷新都需要重新加载j s 重新请求device id,这样独立出来就不会被刷新。然后呢我发现很多组件很没必要地刷新，我想要usememo解决这个问题

然后呢我又发现nexted component太多了，一个token要穿越五六层component,可以考虑

## 优化：

在设计响应式页面我制作了大量的global length 来确保每个部件行为一致，同样的，即使部分代码使用css我也希望提高复用性，所以我引入sass

然后我开始发现页面有些卡了，之前都是用display none的，不能用了，我用 react router按需要加载

后来发现使用route的话，左侧的player会不停地加载，因为这个事从spotify网站动态插入code的，也就是每次player组件加载，就会请求player对象。所以我把整个左侧栏全部变成navBar, 利用react router的组件式路由特性，把navBar 隔离在路由之外



## Spotify 的OAuth是如何工作的

## 优化需求



album页面和其他页面有一些不同， 因为得到的album object拥有完整的track信息，所以我不再需要进行请求，

artist页面需要进行请求

flex布局的时候没有设置grow属性导致页面即使只有两个元素也无法横向充满，只能保持子元素填充的宽度，宽度失效

只用css制作responsive的正方形很难，需要用js

z-index的知识点

错误:想要播放音乐需要position才可以

细节：Searcher 强制取消聚焦

确保deviceId准备好了再渲染

问题发现，每次刷新的时候都会重新请求deviceId,超级多的请求 而且用户不停切换的时候太快导致请求的新的device_id还没到，那就无法播放会出错



## HighLight: 

stop player refresh

fully responsive



遇到的问题，我发现album page和artist page在左侧的重合率太高了，所以我一想这不就是navbar吗，所以我把左侧component独立出来然后用nested router 和outlet只刷新右侧，这让player的状态贯穿所有页面，player每次刷新都需要重新加载j s 重新请求device id, 遇到的问题，因为是nested url,打个比方以前是/album /artist, 现在要先进入/traditional 装配左侧组件，再根据右侧router装配，所以是/traditional/album 这样，我需要把大量的共用代码拆分放到/traditional对应的组件里面，在这个时候，我没意识到我的proxy和server也要加/traditional，所以花了很多时间在上面.同时，有的请求是在/下请求的就不需要/traditional



状态控制，传播与async函数的问题： 我们要让useEffect只在必要的时候运行，同时setState保证一要在必要的时候重新渲染。打个比方我们有很多个async函数，。。。

不同的写法对比，如果用async/await写法，变量值会以null先返回，如果在.then()中等待可能更好





大坑： setState不更新的原因：例子，我有一个array是async得来的album： 渲染不会等待数组我承认，我准备了default case, 然后我发现，得到数组之后update,居然，不rerender, 后来我发现，setstate只是欠监听，要变化被发现，需要用三点表达式









